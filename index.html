<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#fbbf24">
    <title>Daily Chuckle</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Lilita+One&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Fredoka', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #fffbea 0%, #fef3c7 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 0 16px 100px 16px;
        }

        header {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            padding: 16px 16px 20px 16px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .streak-badge {
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(10px);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .streak-badge.champion {
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .day-badge {
            background: rgba(255,255,255,0.25);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: white;
            font-weight: 600;
        }

        header h1 {
            font-family: 'Lilita One', cursive;
            font-size: 2.4rem;
            color: white;
            text-shadow: 3px 3px 0px rgba(0,0,0,0.15),
                         -1px -1px 0px rgba(255,255,255,0.3);
            letter-spacing: 1px;
            transform: rotate(-2deg);
            display: inline-block;
        }

        header h1 .wiggle {
            display: inline-block;
            animation: wiggle 0.5s ease-in-out infinite;
        }

        header h1 .wiggle:nth-child(2) { animation-delay: 0.1s; }
        header h1 .wiggle:nth-child(3) { animation-delay: 0.2s; }

        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }

        .section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 16px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 3px solid transparent;
            transition: border-color 0.3s;
        }

        .section:hover {
            border-color: #fde68a;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .section-emoji {
            font-size: 2rem;
            filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.1));
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #374151;
        }

        .riddle-text {
            font-style: italic;
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 16px;
            white-space: pre-line;
            line-height: 1.8;
            border: 2px dashed #c4b5fd;
        }

        .joke-text, .quiz-text {
            font-size: 1.1rem;
            margin-bottom: 16px;
            padding: 14px;
            background: #f0f9ff;
            border-radius: 16px;
            border: 2px dashed #93c5fd;
        }

        .quiz-text {
            background: #ecfdf5;
            border-color: #6ee7b7;
        }

        input[type="text"] {
            width: 100%;
            padding: 14px 16px;
            font-size: 1rem;
            font-family: 'Fredoka', sans-serif;
            border: 3px solid #e5e7eb;
            border-radius: 14px;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input[type="text"]:focus {
            border-color: #fbbf24;
            box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.2);
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            background: #f9fafb;
            border: 3px solid #e5e7eb;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 44px;
            font-weight: 500;
        }

        .quiz-option:hover {
            border-color: #fbbf24;
            background: #fffbeb;
            transform: translateX(4px);
        }

        .quiz-option.selected {
            border-color: #fbbf24;
            background: #fef3c7;
        }

        .quiz-option input {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            accent-color: #f59e0b;
        }

        .submit-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            background: white;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
        }

        .submit-btn {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            display: block;
            padding: 16px 24px;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'Fredoka', sans-serif;
            color: white;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border: none;
            border-radius: 14px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            min-height: 54px;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Results Styles */
        .results-section {
            display: none;
        }

        /* Result Character Display */
        .result-character {
            text-align: center;
            margin-bottom: 20px;
            min-height: 120px;
            position: relative;
            overflow: hidden;
        }

        .sad-person {
            font-size: 100px;
            animation: sadBounce 1s ease-in-out;
        }

        @keyframes sadBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .pillow-thrower {
            position: relative;
            display: inline-block;
            width: 100%;
            height: 140px;
        }

        .pillow-person {
            font-size: 70px;
            display: inline-block;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            animation: throwMotion 1.2s ease-out forwards;
        }

        @keyframes throwMotion {
            0% { transform: translateX(-50%) rotate(0deg); }
            20% { transform: translateX(-50%) rotate(-25deg); }
            40% { transform: translateX(-50%) rotate(15deg); }
            60% { transform: translateX(-50%) rotate(-10deg); }
            100% { transform: translateX(-50%) rotate(0deg); }
        }

        .flying-pillow {
            position: absolute;
            font-size: 50px;
            top: 20px;
            left: 50%;
            animation: pillowFly 4s ease-in-out forwards;
        }

        @keyframes pillowFly {
            0% {
                transform: translateX(-50%) translateY(0) rotate(0deg);
                opacity: 1;
            }
            10% {
                transform: translateX(-20px) translateY(-20px) rotate(45deg);
                opacity: 1;
            }
            20% {
                transform: translateX(20px) translateY(-40px) rotate(-30deg);
                opacity: 1;
            }
            30% {
                transform: translateX(50px) translateY(-30px) rotate(60deg);
                opacity: 1;
            }
            40% {
                transform: translateX(80px) translateY(-50px) rotate(-45deg);
                opacity: 1;
            }
            50% {
                transform: translateX(120px) translateY(-35px) rotate(90deg);
                opacity: 1;
            }
            60% {
                transform: translateX(160px) translateY(-55px) rotate(-60deg);
                opacity: 1;
            }
            70% {
                transform: translateX(200px) translateY(-40px) rotate(120deg);
                opacity: 1;
            }
            80% {
                transform: translateX(260px) translateY(-60px) rotate(-90deg);
                opacity: 0.8;
            }
            90% {
                transform: translateX(350px) translateY(-50px) rotate(180deg);
                opacity: 0.5;
            }
            100% {
                transform: translateX(500px) translateY(-30px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Crying face with tears */
        .crying-container {
            position: relative;
            display: inline-block;
        }

        .crying-face {
            font-size: 100px;
            animation: sadBounce 1s ease-in-out;
        }

        .tear {
            position: absolute;
            font-size: 30px;
            opacity: 0;
            animation: tearDrop 1.5s ease-in infinite;
        }

        .tear-left {
            left: 25%;
            top: 50%;
        }

        .tear-right {
            right: 25%;
            top: 50%;
            animation-delay: 0.7s;
        }

        .tear-left-2 {
            left: 30%;
            top: 55%;
            animation-delay: 0.3s;
        }

        .tear-right-2 {
            right: 30%;
            top: 55%;
            animation-delay: 1s;
        }

        @keyframes tearDrop {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0;
            }
            20% {
                opacity: 1;
                transform: translateY(10px) scale(1);
            }
            50% {
                transform: translateY(40px) translateX(-10px) scale(0.9);
                opacity: 0.8;
            }
            80% {
                transform: translateY(80px) translateX(5px) scale(0.7);
                opacity: 0.5;
            }
            100% {
                transform: translateY(120px) translateX(-5px) scale(0.3);
                opacity: 0;
            }
        }

        /* Head banging animation for 0/3 */
        .headbang-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0;
            height: 120px;
        }

        .wall {
            font-size: 80px;
            line-height: 1;
        }

        .headbang-person {
            font-size: 70px;
            animation: headbang 0.4s ease-in-out infinite;
            transform-origin: bottom center;
        }

        @keyframes headbang {
            0%, 100% {
                transform: rotate(0deg) translateX(0);
            }
            50% {
                transform: rotate(-15deg) translateX(-10px);
            }
        }

        .wakeup-text {
            font-family: 'Lilita One', cursive;
            font-size: 1.1rem;
            color: #ef4444;
            margin-top: 15px;
            animation: textPulse 1s ease-in-out infinite;
        }

        @keyframes textPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        .result-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            border-radius: 14px;
            margin-bottom: 12px;
        }

        .result-item.correct {
            background: #ecfdf5;
            border: 3px solid #10b981;
        }

        .result-item.incorrect {
            background: #fef2f2;
            border: 3px solid #ef4444;
        }

        .result-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .result-content {
            flex: 1;
        }

        .result-label {
            font-weight: 700;
            margin-bottom: 4px;
        }

        .result-answer {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .result-explanation {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        .score-display {
            text-align: center;
            padding: 24px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 20px;
            color: white;
            margin-bottom: 16px;
        }

        .score-display.champion {
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
        }

        .score-display.sad {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        .score-number {
            font-size: 3.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        .score-label {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 600;
        }

        .champion-banner {
            display: none;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 3px solid #f59e0b;
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            margin-bottom: 16px;
            animation: fadeIn 0.5s ease-out;
        }

        .champion-banner.visible {
            display: block;
        }

        .champion-title {
            font-family: 'Lilita One', cursive;
            font-size: 1.5rem;
            color: #92400e;
            margin-bottom: 8px;
        }

        .champion-streak {
            font-size: 1rem;
            color: #b45309;
            font-weight: 600;
        }

        /* Pun Reveal */
        .pun-section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .pun-section.visible {
            display: block;
        }

        .pun-content {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            font-size: 1.1rem;
            border: 3px dashed #f59e0b;
        }

        .pun-label {
            font-weight: 700;
            color: #92400e;
            margin-bottom: 12px;
            font-size: 1rem;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Fireworks Canvas */
        #fireworksCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        /* Already Completed State */
        .completed-message {
            text-align: center;
            padding: 40px 20px;
        }

        .completed-message h2 {
            font-size: 1.5rem;
            margin-bottom: 16px;
            color: #374151;
        }

        .completed-message p {
            color: #6b7280;
            margin-bottom: 8px;
        }

        .completed-score {
            font-size: 2.5rem;
            font-weight: 700;
            color: #f59e0b;
            margin: 16px 0;
        }

        .completed-streak {
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            display: inline-block;
            font-weight: 700;
            margin-top: 12px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-top">
            <div class="streak-badge" id="streakBadge">
                <span>üî•</span>
                <span id="streakCount">0</span> day streak
            </div>
            <div class="day-badge" id="dayDisplay">Day 1</div>
        </div>
        <h1>
            <span class="wiggle">D</span>aily
            <span class="wiggle">C</span>huck<span class="wiggle">l</span>e
        </h1>
    </header>

    <div class="container">
        <!-- Challenge Section (shown when not completed) -->
        <div id="challengeSection">
            <!-- Riddle -->
            <div class="section">
                <div class="section-header">
                    <span class="section-emoji">üé≠</span>
                    <h2 class="section-title">Riddle Me This</h2>
                </div>
                <div class="riddle-text" id="riddleText"></div>
                <input type="text" id="riddleAnswer" placeholder="Your answer..." autocomplete="off">
            </div>

            <!-- Joke -->
            <div class="section">
                <div class="section-header">
                    <span class="section-emoji">üòÑ</span>
                    <h2 class="section-title">Fill in the Punchline</h2>
                </div>
                <div class="joke-text" id="jokeText"></div>
                <input type="text" id="jokeAnswer" placeholder="The punchline is..." autocomplete="off">
            </div>

            <!-- Quiz -->
            <div class="section">
                <div class="section-header">
                    <span class="section-emoji">üß†</span>
                    <h2 class="section-title">Brain Teaser</h2>
                </div>
                <div class="quiz-text" id="quizText"></div>
                <div class="quiz-options" id="quizOptions"></div>
            </div>
        </div>

        <!-- Results Section (shown after submission) -->
        <div id="resultsSection" class="results-section">
            <!-- Character display area -->
            <div class="result-character" id="resultCharacter"></div>

            <div class="score-display" id="scoreDisplay">
                <div class="score-number" id="scoreNumber">0/3</div>
                <div class="score-label" id="scoreLabel">Correct Answers</div>
            </div>

            <div class="champion-banner" id="championBanner">
                <div class="champion-title">üèÜ Chuckle Champion! üèÜ</div>
                <div class="champion-streak" id="championStreak">You're on a 1 day streak!</div>
            </div>

            <div class="section">
                <div id="resultsContainer"></div>
            </div>

            <!-- Pun Section -->
            <div id="punSection" class="section pun-section">
                <div class="section-header">
                    <span class="section-emoji">üéÅ</span>
                    <h2 class="section-title">Bonus Pun Unlocked!</h2>
                </div>
                <div class="pun-content">
                    <div class="pun-label">Your reward for becoming a Chuckle Champion:</div>
                    <div id="punText"></div>
                </div>
            </div>

            <div class="section" style="text-align: center;">
                <p style="color: #6b7280;">Come back tomorrow for new challenges!</p>
            </div>
        </div>

        <!-- Already Completed Section -->
        <div id="completedSection" class="completed-message hidden">
            <h2>You've already played today!</h2>
            <p>Your score was:</p>
            <div class="completed-score" id="completedScore">0/3</div>
            <div class="completed-streak hidden" id="completedStreak">üî• 1 day streak!</div>
            <p style="margin-top: 20px;">Come back tomorrow for new challenges!</p>
        </div>
    </div>

    <!-- Submit Button -->
    <div class="submit-container" id="submitContainer">
        <button class="submit-btn" id="submitBtn" onclick="submitAnswers()">Submit Answers</button>
    </div>

    <!-- Fireworks Canvas -->
    <canvas id="fireworksCanvas"></canvas>

    <script>
        // ==================== AUDIO SYSTEM ====================
        const AudioSystem = {
            ctx: null,
            initialized: false,

            init() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }
                this.initialized = true;
            },

            // Text-to-speech for voice lines
            speak(text, pitch = 1, rate = 1) {
                if ('speechSynthesis' in window) {
                    // Cancel any pending speech
                    speechSynthesis.cancel();

                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.pitch = pitch;
                    utterance.rate = rate;
                    utterance.volume = 1;

                    // Try to get a voice
                    const voices = speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        utterance.voice = voices[0];
                    }

                    speechSynthesis.speak(utterance);
                }
            },

            // Sad voice for "Bad Luck"
            sayBadLuck() {
                // Ensure voices are loaded
                if (speechSynthesis.getVoices().length === 0) {
                    speechSynthesis.onvoiceschanged = () => {
                        this.speak("Bad Luck", 0.3, 0.5);
                    };
                } else {
                    this.speak("Bad Luck", 0.3, 0.5);
                }
            },

            // Happy voice for "You got it!"
            sayYouGotIt() {
                if (speechSynthesis.getVoices().length === 0) {
                    speechSynthesis.onvoiceschanged = () => {
                        this.speak("You got it!", 1.3, 1.0);
                    };
                } else {
                    this.speak("You got it!", 1.3, 1.0);
                }
            },

            // Stern voice for "Wake up sleepy"
            sayWakeUp() {
                if (speechSynthesis.getVoices().length === 0) {
                    speechSynthesis.onvoiceschanged = () => {
                        this.speak("Wake up sleepy! You're not a chuckle champion today!", 0.8, 0.9);
                    };
                } else {
                    this.speak("Wake up sleepy! You're not a chuckle champion today!", 0.8, 0.9);
                }
            },

            // Generate LOUD fart sound using Web Audio API
            playFartSound() {
                this.init();
                const ctx = this.ctx;

                // Multiple fart bursts for a longer, louder effect
                this.playFartBurst(ctx, 0, 0.6);
                this.playFartBurst(ctx, 0.15, 0.4);
                this.playFartBurst(ctx, 0.35, 0.5);
            },

            playFartBurst(ctx, delay, duration) {
                const bufferSize = Math.floor(ctx.sampleRate * duration);
                const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                const data = buffer.getChannelData(0);

                // Generate brown noise with wobble
                let lastOut = 0;
                for (let i = 0; i < bufferSize; i++) {
                    const white = Math.random() * 2 - 1;
                    lastOut = (lastOut + (0.02 * white)) / 1.02;
                    const envelope = Math.sin(Math.PI * i / bufferSize);
                    const wobble = 1 + 0.5 * Math.sin(50 * Math.PI * i / ctx.sampleRate);
                    const flutter = 1 + 0.3 * Math.sin(120 * Math.PI * i / ctx.sampleRate);
                    data[i] = lastOut * 4 * envelope * wobble * flutter;
                }

                const source = ctx.createBufferSource();
                source.buffer = buffer;

                const lowpass = ctx.createBiquadFilter();
                lowpass.type = 'lowpass';
                lowpass.frequency.value = 200;

                const gain = ctx.createGain();
                gain.gain.value = 3; // LOUD

                source.connect(lowpass);
                lowpass.connect(gain);
                gain.connect(ctx.destination);

                source.start(ctx.currentTime + delay);
            },

            // Firework explosion sound
            playFireworkSound() {
                this.init();
                const ctx = this.ctx;

                const duration = 0.3;
                const bufferSize = ctx.sampleRate * duration;
                const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                const data = buffer.getChannelData(0);

                for (let i = 0; i < bufferSize; i++) {
                    const t = i / ctx.sampleRate;
                    const envelope = Math.exp(-t * 10);
                    data[i] = (Math.random() * 2 - 1) * envelope;
                }

                const source = ctx.createBufferSource();
                source.buffer = buffer;

                const highpass = ctx.createBiquadFilter();
                highpass.type = 'highpass';
                highpass.frequency.value = 1000;

                const gain = ctx.createGain();
                gain.gain.value = 0.3;

                source.connect(highpass);
                highpass.connect(gain);
                gain.connect(ctx.destination);

                source.start();
            }
        };

        // ==================== FIREWORKS SYSTEM ====================
        const FireworksSystem = {
            canvas: null,
            ctx: null,
            particles: [],
            rockets: [],
            running: false,

            init() {
                this.canvas = document.getElementById('fireworksCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.resize();
                window.addEventListener('resize', () => this.resize());
            },

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            },

            createExplosion(x, y, color) {
                const particleCount = 80;
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const velocity = 2 + Math.random() * 4;
                    this.particles.push({
                        x, y,
                        vx: Math.cos(angle) * velocity,
                        vy: Math.sin(angle) * velocity,
                        life: 1,
                        color,
                        size: 2 + Math.random() * 2
                    });
                }
                AudioSystem.playFireworkSound();
            },

            launchRocket() {
                const x = Math.random() * this.canvas.width;
                const colors = ['#ff0040', '#00ff40', '#4000ff', '#ffff00', '#ff00ff', '#00ffff', '#ff8000'];
                this.rockets.push({
                    x,
                    y: this.canvas.height,
                    vy: -8 - Math.random() * 4,
                    targetY: 100 + Math.random() * (this.canvas.height * 0.4),
                    color: colors[Math.floor(Math.random() * colors.length)]
                });
            },

            update() {
                // Update rockets
                for (let i = this.rockets.length - 1; i >= 0; i--) {
                    const rocket = this.rockets[i];
                    rocket.y += rocket.vy;
                    if (rocket.y <= rocket.targetY) {
                        this.createExplosion(rocket.x, rocket.y, rocket.color);
                        this.rockets.splice(i, 1);
                    }
                }

                // Update particles
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.05; // gravity
                    p.vx *= 0.99;
                    p.vy *= 0.99;
                    p.life -= 0.015;
                    if (p.life <= 0) {
                        this.particles.splice(i, 1);
                    }
                }
            },

            draw() {
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Draw rockets
                for (const rocket of this.rockets) {
                    this.ctx.beginPath();
                    this.ctx.arc(rocket.x, rocket.y, 3, 0, Math.PI * 2);
                    this.ctx.fillStyle = rocket.color;
                    this.ctx.fill();
                }

                // Draw particles
                for (const p of this.particles) {
                    this.ctx.beginPath();
                    this.ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                    this.ctx.fillStyle = p.color;
                    this.ctx.globalAlpha = p.life;
                    this.ctx.fill();
                    this.ctx.globalAlpha = 1;
                }
            },

            animate() {
                if (!this.running) return;
                this.update();
                this.draw();
                requestAnimationFrame(() => this.animate());
            },

            start(duration = 5000) {
                this.init();
                this.running = true;
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                // Launch rockets periodically
                const launchInterval = setInterval(() => {
                    if (this.running) {
                        this.launchRocket();
                        if (Math.random() > 0.5) this.launchRocket();
                    }
                }, 300);

                this.animate();

                setTimeout(() => {
                    this.running = false;
                    clearInterval(launchInterval);
                    setTimeout(() => {
                        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    }, 2000);
                }, duration);
            }
        };

        // ==================== CONTENT BANK ====================
        const contentBank = [
            {
                day: 1,
                riddle: {
                    text: "I dance without feet, I whisper without voice,\nThrough keyhole and crack I make my choice.\nI cool the fevered, chill the warm,\nYet you cannot grasp me in any form.",
                    answers: ["wind", "breeze", "air", "draft", "the wind", "a breeze"]
                },
                joke: {
                    text: "What do you call a bear with no teeth?",
                    answers: ["gummy bear", "gummy", "a gummy bear"]
                },
                quiz: {
                    text: "If you're running a race and you pass the person in second place, what place are you in now?",
                    options: ["First place", "Second place", "Third place", "Same place"],
                    correct: "B",
                    explanation: "You take their position - you're now second! The person in first is still ahead of you."
                },
                pun: "Why did the wind get a promotion? Because it was outstanding in its field! üí®"
            },
            {
                day: 2,
                riddle: {
                    text: "Born in fire, I live in glass,\nI shrink as moments slowly pass.\nI weep bright tears yet feel no pain,\nWhen darkness falls, I rise again.",
                    answers: ["candle", "a candle", "candlelight", "flame"]
                },
                joke: {
                    text: "Why don't scientists trust atoms?",
                    answers: ["they make up everything", "make up everything", "because they make up everything", "they make everything up"]
                },
                quiz: {
                    text: "Which planet in our solar system is known for its prominent ring system?",
                    options: ["Jupiter", "Saturn", "Uranus", "Neptune"],
                    correct: "B",
                    explanation: "Saturn has the most visible and spectacular ring system, made mostly of ice particles and rocky debris!"
                },
                pun: "I'm reading a book about candles. It's quite en-light-ening! üïØÔ∏è"
            },
            {
                day: 3,
                riddle: {
                    text: "I have cities, but no houses stand,\nI have forests, but no trees expand.\nI have water, but no fish swim free,\nI have roads, but no cars you'll see.",
                    answers: ["map", "a map", "maps", "atlas"]
                },
                joke: {
                    text: "What do you call a fake noodle?",
                    answers: ["impasta", "an impasta", "im-pasta"]
                },
                quiz: {
                    text: "What is the largest ocean on Earth?",
                    options: ["Atlantic Ocean", "Indian Ocean", "Pacific Ocean", "Arctic Ocean"],
                    correct: "C",
                    explanation: "The Pacific Ocean covers about 63 million square miles - more than all the land on Earth combined!"
                },
                pun: "I tried to make a map joke, but I couldn't find the right direction! üó∫Ô∏è"
            },
            {
                day: 4,
                riddle: {
                    text: "I follow you close from morning to night,\nYet vanish completely when fades the light.\nI copy your moves without any sound,\nStretched tall or short upon the ground.",
                    answers: ["shadow", "a shadow", "my shadow", "your shadow", "shadows"]
                },
                joke: {
                    text: "Why did the scarecrow win an award?",
                    answers: ["outstanding in his field", "he was outstanding in his field", "because he was outstanding in his field", "outstanding in the field"]
                },
                quiz: {
                    text: "How many sides does a hexagon have?",
                    options: ["Five", "Six", "Seven", "Eight"],
                    correct: "B",
                    explanation: "A hexagon has six sides! The prefix 'hex' comes from Greek meaning six."
                },
                pun: "I used to be afraid of my shadow, but then I realized we have so much in common - we're both always following me around! üë§"
            },
            {
                day: 5,
                riddle: {
                    text: "I build without hands, I trap without rope,\nIn corners I wait with patience and hope.\nMy art is destruction dressed up so fine,\nEight legs I possess, yet walk in a line.",
                    answers: ["spider", "a spider", "spiders"]
                },
                joke: {
                    text: "What do you call a sleeping dinosaur?",
                    answers: ["dino-snore", "a dino-snore", "dinosnore"]
                },
                quiz: {
                    text: "Which country is both a continent and a country?",
                    options: ["New Zealand", "Australia", "Indonesia", "Papua New Guinea"],
                    correct: "B",
                    explanation: "Australia is the only country that is also its own continent! It's the world's largest island and smallest continent."
                },
                pun: "A spider just opened a web design business. Their site is really catching on! üï∑Ô∏è"
            },
            {
                day: 6,
                riddle: {
                    text: "I have hands but cannot clap,\nA face but cannot smile or nap.\nI tell you things without a word,\nMy voice is ticking, always heard.",
                    answers: ["clock", "a clock", "watch", "a watch", "time"]
                },
                joke: {
                    text: "Why did the bicycle fall over?",
                    answers: ["two tired", "it was two tired", "because it was two tired", "too tired", "it was too tired"]
                },
                quiz: {
                    text: "What is the capital of Japan?",
                    options: ["Seoul", "Beijing", "Tokyo", "Bangkok"],
                    correct: "C",
                    explanation: "Tokyo is Japan's capital and largest city, home to over 13 million people!"
                },
                pun: "I tried to make a clock joke, but I didn't have the time! ‚è∞"
            },
            {
                day: 7,
                riddle: {
                    text: "The more you take, the more you leave behind.\nLook down below, see what you find.\nI follow your journey, marking your way,\nYet disappear not at the end of day.",
                    answers: ["footsteps", "footprints", "steps", "tracks"]
                },
                joke: {
                    text: "What do you call a fish without eyes?",
                    answers: ["fsh", "a fsh"]
                },
                quiz: {
                    text: "How many bones does an adult human body have?",
                    options: ["106", "206", "306", "406"],
                    correct: "B",
                    explanation: "Adults have 206 bones! Babies are born with about 270, but many fuse together as we grow."
                },
                pun: "I'm reading a book about footprints. It has a great following! üë£"
            },
            {
                day: 8,
                riddle: {
                    text: "I can fly without wings so high,\nI can make grown people cry.\nI'm born from joy or sometimes pain,\nOnce I fall, I won't rise again.",
                    answers: ["tear", "tears", "a tear", "teardrop"]
                },
                joke: {
                    text: "What do you call a boomerang that doesn't come back?",
                    answers: ["stick", "a stick"]
                },
                quiz: {
                    text: "Which element has the chemical symbol 'O'?",
                    options: ["Gold", "Osmium", "Oxygen", "Oganesson"],
                    correct: "C",
                    explanation: "Oxygen uses 'O' - it makes up about 21% of Earth's atmosphere!"
                },
                pun: "I tried to catch some fog earlier. I mist! üí®"
            },
            {
                day: 9,
                riddle: {
                    text: "I speak without a mouth or tongue,\nMy tales are old, my words are young.\nOpen me up and worlds appear,\nClose me shut, they disappear.",
                    answers: ["book", "a book", "books"]
                },
                joke: {
                    text: "Why don't eggs tell jokes?",
                    answers: ["they'd crack each other up", "crack each other up", "they would crack each other up", "because they'd crack each other up"]
                },
                quiz: {
                    text: "What is the smallest country in the world?",
                    options: ["Monaco", "San Marino", "Vatican City", "Liechtenstein"],
                    correct: "C",
                    explanation: "Vatican City is only 0.17 square miles - you could walk across it in about 20 minutes!"
                },
                pun: "I'm friends with all the books at the library. We're on the same page! üìö"
            },
            {
                day: 10,
                riddle: {
                    text: "I have keys but open no locks,\nI have space but no room for blocks.\nYou press me daily, tap and pound,\nYet through my teeth comes only sound.",
                    answers: ["keyboard", "a keyboard", "piano", "a piano"]
                },
                joke: {
                    text: "What do you call a can opener that doesn't work?",
                    answers: ["can't opener", "a can't opener"]
                },
                quiz: {
                    text: "How many strings does a standard guitar have?",
                    options: ["4", "5", "6", "8"],
                    correct: "C",
                    explanation: "Standard guitars have 6 strings, tuned E-A-D-G-B-E from lowest to highest!"
                },
                pun: "I told my computer I needed a break. Now it won't stop sending me vacation ads! üíª"
            },
            {
                day: 11,
                riddle: {
                    text: "I run forever, never walk,\nI murmur often, never talk.\nI have a bed but do not sleep,\nI have a mouth but secrets keep.",
                    answers: ["river", "a river", "stream", "creek"]
                },
                joke: {
                    text: "What do you call a pig that does karate?",
                    answers: ["pork chop", "a pork chop"]
                },
                quiz: {
                    text: "What is the longest river in the world?",
                    options: ["Amazon", "Nile", "Yangtze", "Mississippi"],
                    correct: "B",
                    explanation: "The Nile is approximately 4,132 miles long, flowing through 11 African countries!"
                },
                pun: "Rivers are great at networking - they always go with the flow! üåä"
            },
            {
                day: 12,
                riddle: {
                    text: "I'm tall when young and short when old,\nMy life is measured, bought and sold.\nI fear the wind and water's kiss,\nOne breath from you ends all of this.",
                    answers: ["candle", "a candle", "flame", "fire"]
                },
                joke: {
                    text: "Why did the tomato turn red?",
                    answers: ["it saw the salad dressing", "because it saw the salad dressing", "saw the salad dressing"]
                },
                quiz: {
                    text: "What is the hardest natural substance on Earth?",
                    options: ["Gold", "Iron", "Diamond", "Platinum"],
                    correct: "C",
                    explanation: "Diamond scores a perfect 10 on the Mohs hardness scale - nothing natural can scratch it!"
                },
                pun: "I was going to tell a candle joke, but I didn't want to burn anyone! üïØÔ∏è"
            },
            {
                day: 13,
                riddle: {
                    text: "I can travel the world while staying in my corner.\nI connect the distant, unite the foreigner.\nWith a lick and a stick, I'm ready to go,\nThrough rain and through sunshine, through sleet and through snow.",
                    answers: ["stamp", "a stamp", "postage stamp", "mail"]
                },
                joke: {
                    text: "What do you call a lazy kangaroo?",
                    answers: ["pouch potato", "a pouch potato"]
                },
                quiz: {
                    text: "Which country invented paper?",
                    options: ["Egypt", "Greece", "China", "India"],
                    correct: "C",
                    explanation: "Paper was invented in China around 105 AD by Cai Lun during the Han Dynasty!"
                },
                pun: "I tried to write a letter to my stamp collection, but I couldn't address the issue! üìÆ"
            },
            {
                day: 14,
                riddle: {
                    text: "I have teeth but cannot bite,\nI help you look your very best, just right.\nThrough tangles and knots I make my way,\nI smooth things over, day by day.",
                    answers: ["comb", "a comb", "brush", "hairbrush"]
                },
                joke: {
                    text: "What do you call a dinosaur that crashes their car?",
                    answers: ["tyrannosaurus wrecks", "tyrannosaurus wreck", "t-rex wreck"]
                },
                quiz: {
                    text: "What year did World War II end?",
                    options: ["1943", "1944", "1945", "1946"],
                    correct: "C",
                    explanation: "WWII ended in 1945 - Germany surrendered in May, Japan in August after the atomic bombs."
                },
                pun: "Bad hair days really brush me the wrong way! üíá"
            },
            {
                day: 15,
                riddle: {
                    text: "I start with 'e' and end with 'e',\nBut only one letter lives in me.\nI carry words from here to there,\nSealed with love, sent through the air.",
                    answers: ["envelope", "an envelope"]
                },
                joke: {
                    text: "What do you call a cow with no legs?",
                    answers: ["ground beef", "ground beef!"]
                },
                quiz: {
                    text: "What is the speed of light (approximately)?",
                    options: ["186,000 miles per hour", "186,000 miles per second", "1,860 miles per second", "18,600 miles per second"],
                    correct: "B",
                    explanation: "Light travels at about 186,000 miles per SECOND - fast enough to circle Earth 7.5 times in one second!"
                },
                pun: "I sent a letter to my friend but forgot the stamp. I guess you could say it was... post-poned! ‚úâÔ∏è"
            },
            {
                day: 16,
                riddle: {
                    text: "I grow in darkness, dressed in white,\nI'm found in forests, quite a sight.\nWith cap and stem I stand so small,\nSome feed you well, some end it all.",
                    answers: ["mushroom", "a mushroom", "mushrooms", "fungi"]
                },
                joke: {
                    text: "Why did the mushroom go to the party?",
                    answers: ["because he was a fungi", "he was a fungi", "because he's a fun guy", "he's a fun guy", "fun guy", "fungi"]
                },
                quiz: {
                    text: "What percentage of the Earth's surface is covered by water?",
                    options: ["51%", "61%", "71%", "81%"],
                    correct: "C",
                    explanation: "About 71% of Earth is covered by water - but only 3% of that is freshwater!"
                },
                pun: "I don't trust mushrooms - there's not mushroom for error with some of them! üçÑ"
            },
            {
                day: 17,
                riddle: {
                    text: "I have a neck but have no head,\nI wear a cap but have no bed.\nI help pour liquid, smooth and neat,\nAt dinner tables, I'm a treat.",
                    answers: ["bottle", "a bottle"]
                },
                joke: {
                    text: "What do you call a belt made of watches?",
                    answers: ["waist of time", "a waist of time", "waste of time"]
                },
                quiz: {
                    text: "How many teeth does an adult human typically have?",
                    options: ["28", "30", "32", "34"],
                    correct: "C",
                    explanation: "Adults have 32 teeth including wisdom teeth - though many people have their wisdom teeth removed!"
                },
                pun: "I was going to tell a bottle joke, but I didn't want to wine about it! üçæ"
            },
            {
                day: 18,
                riddle: {
                    text: "I'm not alive, but I can grow.\nI don't have lungs, but I need air to flow.\nI don't have a mouth, but water kills me slow.\nWhat am I? You surely know!",
                    answers: ["fire", "flame", "a fire"]
                },
                joke: {
                    text: "What do you call a dog that does magic?",
                    answers: ["labracadabrador", "a labracadabrador", "labracadabra"]
                },
                quiz: {
                    text: "What is the largest organ in the human body?",
                    options: ["Heart", "Liver", "Skin", "Lungs"],
                    correct: "C",
                    explanation: "Your skin is your largest organ - it covers about 20 square feet in adults!"
                },
                pun: "Fire safety is no joke - but this one is lit! üî•"
            },
            {
                day: 19,
                riddle: {
                    text: "I fall from the sky but I'm not rain,\nI cover the ground like a white terrain.\nI'm cold to touch, I melt away,\nKids love to see me on a winter's day.",
                    answers: ["snow", "snowflake", "snowflakes"]
                },
                joke: {
                    text: "What do snowmen eat for breakfast?",
                    answers: ["frosted flakes", "frosted flakes!", "frost flakes"]
                },
                quiz: {
                    text: "What is the smallest planet in our solar system?",
                    options: ["Mars", "Mercury", "Pluto", "Venus"],
                    correct: "B",
                    explanation: "Mercury is the smallest planet - it's only slightly larger than Earth's Moon! (Pluto is a dwarf planet)"
                },
                pun: "I tried to catch a snowflake but it gave me the cold shoulder! ‚ùÑÔ∏è"
            },
            {
                day: 20,
                riddle: {
                    text: "Round as a button, deep as the sea,\nI have no door but hold a key.\nLook into me and you will find,\nA window straight into your mind.",
                    answers: ["eye", "eyes", "an eye", "the eye"]
                },
                joke: {
                    text: "What do you call an alligator in a vest?",
                    answers: ["investigator", "an investigator"]
                },
                quiz: {
                    text: "Which planet is known as the 'Red Planet'?",
                    options: ["Venus", "Mars", "Jupiter", "Mercury"],
                    correct: "B",
                    explanation: "Mars appears red because its surface is covered in iron oxide (rust)!"
                },
                pun: "Eye jokes are cornea than you think! üëÅÔ∏è"
            },
            {
                day: 21,
                riddle: {
                    text: "I wave at you but have no hand,\nI bow to shores of every land.\nBorn from moon and wind and tide,\nIn me the surfers love to ride.",
                    answers: ["wave", "waves", "ocean wave", "a wave"]
                },
                joke: {
                    text: "What do you call a fish that wears a bowtie?",
                    answers: ["sofishticated", "so-fish-ticated"]
                },
                quiz: {
                    text: "What is the largest mammal in the world?",
                    options: ["Elephant", "Blue Whale", "Giraffe", "Hippopotamus"],
                    correct: "B",
                    explanation: "Blue whales can be over 100 feet long and weigh up to 200 tons - heavier than 30 elephants!"
                },
                pun: "Ocean waves are so friendly - they're always willing to break the ice! üåä"
            },
            {
                day: 22,
                riddle: {
                    text: "I am a box that holds keys without locks,\nYet they open no doors, these keys are rocks.\nBlack and white, my teeth are shown,\nPress me gently, hear my tone.",
                    answers: ["piano", "a piano", "keyboard"]
                },
                joke: {
                    text: "What do you call a bear stuck in the rain?",
                    answers: ["drizzly bear", "a drizzly bear", "drizzly"]
                },
                quiz: {
                    text: "How many notes are in a musical octave?",
                    options: ["6", "7", "8", "9"],
                    correct: "C",
                    explanation: "An octave has 8 notes - that's where the name comes from! (Oct = eight in Latin)"
                },
                pun: "Piano jokes really strike a chord with me! üéπ"
            },
            {
                day: 23,
                riddle: {
                    text: "I can be cracked, I can be made.\nI can be told, I can be played.\nI'm sometimes dark, I'm sometimes dry,\nLaugh with me or maybe cry.",
                    answers: ["joke", "a joke", "jokes"]
                },
                joke: {
                    text: "What do you call a parade of rabbits hopping backwards?",
                    answers: ["receding hare line", "a receding hare line", "receding hairline"]
                },
                quiz: {
                    text: "What is the national animal of Scotland?",
                    options: ["Lion", "Dragon", "Unicorn", "Griffin"],
                    correct: "C",
                    explanation: "Scotland's national animal is the unicorn! It has been a Scottish symbol since the 12th century."
                },
                pun: "I wanted to write a joke about paper, but it was tearable! üìù"
            },
            {
                day: 24,
                riddle: {
                    text: "I run around the yard but never move,\nI keep things in, I keep things out, I prove.\nPainted white or stained with care,\nDogs may bark but I don't care.",
                    answers: ["fence", "a fence"]
                },
                joke: {
                    text: "What do you call a cow that plays an instrument?",
                    answers: ["moo-sician", "a moosician", "musician"]
                },
                quiz: {
                    text: "What is the largest desert in the world?",
                    options: ["Sahara", "Gobi", "Antarctic", "Arabian"],
                    correct: "C",
                    explanation: "Antarctica is technically the largest desert - a desert is defined by low precipitation, not heat!"
                },
                pun: "I'm on the fence about fence jokes - they can go either way! üè°"
            },
            {
                day: 25,
                riddle: {
                    text: "I bloom without petals, I grow without soil,\nI shine without sun through darkness and toil.\nIn the black sky I twinkle so bright,\nGuiding the lost through the blanket of night.",
                    answers: ["star", "stars", "a star"]
                },
                joke: {
                    text: "What do you call a sleeping dinosaur?",
                    answers: ["dino-snore", "a dino-snore", "dinosnore"]
                },
                quiz: {
                    text: "How many planets in our solar system have rings?",
                    options: ["1", "2", "3", "4"],
                    correct: "D",
                    explanation: "Jupiter, Saturn, Uranus, AND Neptune all have rings - Saturn's are just the most visible!"
                },
                pun: "Star jokes are out of this world! ‚≠ê"
            },
            {
                day: 26,
                riddle: {
                    text: "I have branches but no fruit to bear,\nNo leaves, no roots, yet I'm everywhere.\nInside your walls I make my home,\nCarrying power wherever I roam.",
                    answers: ["wire", "wires", "electrical wire", "electricity", "cable"]
                },
                joke: {
                    text: "What do you call a computer that sings?",
                    answers: ["a-dell", "adele", "a dell"]
                },
                quiz: {
                    text: "Who invented the telephone?",
                    options: ["Thomas Edison", "Alexander Graham Bell", "Nikola Tesla", "Benjamin Franklin"],
                    correct: "B",
                    explanation: "Alexander Graham Bell patented the telephone in 1876 - his first words were 'Mr. Watson, come here!'"
                },
                pun: "Electricity jokes really spark my interest! ‚ö°"
            },
            {
                day: 27,
                riddle: {
                    text: "I'm always hungry, I must be fed.\nThe finger I touch will soon turn red.\nI dance and I flicker, I light up the night,\nBut give me too much and I'll grow out of sight.",
                    answers: ["fire", "flame", "flames", "a fire"]
                },
                joke: {
                    text: "What do you call a ghost's favorite dessert?",
                    answers: ["ice scream", "i scream", "boo-berry pie"]
                },
                quiz: {
                    text: "What is the most spoken language in the world by number of native speakers?",
                    options: ["English", "Spanish", "Mandarin Chinese", "Hindi"],
                    correct: "C",
                    explanation: "Mandarin Chinese has about 920 million native speakers - nearly 3x more than Spanish!"
                },
                pun: "That fire joke was too hot to handle! üî•"
            },
            {
                day: 28,
                riddle: {
                    text: "I have a spine but I'm not alive,\nI tell you stories, help minds thrive.\nOpen me up and worlds unfold,\nInside me lie both new and old.",
                    answers: ["book", "a book", "books"]
                },
                joke: {
                    text: "What do you call a train loaded with toffee?",
                    answers: ["chew chew train", "a chew chew train", "choo choo"]
                },
                quiz: {
                    text: "In what year did the Titanic sink?",
                    options: ["1910", "1912", "1914", "1916"],
                    correct: "B",
                    explanation: "The Titanic sank on April 15, 1912, after hitting an iceberg on its maiden voyage."
                },
                pun: "I tried to write a book about trains - it had a great plot but went off the rails! üìñ"
            },
            {
                day: 29,
                riddle: {
                    text: "You can see right through me, but I can break.\nI'll fog up when hot, shatter when you shake.\nIn windows I sit, in cups I hold,\nHandle with care, or so I'm told.",
                    answers: ["glass", "a glass"]
                },
                joke: {
                    text: "What do you call a group of musical whales?",
                    answers: ["an orca-stra", "orca-stra", "orchestra"]
                },
                quiz: {
                    text: "What is the only metal that is liquid at room temperature?",
                    options: ["Lead", "Aluminum", "Mercury", "Silver"],
                    correct: "C",
                    explanation: "Mercury melts at -38¬∞F - it's been used in thermometers for centuries because of this!"
                },
                pun: "Glass jokes are transparent but they still crack me up! ü™ü"
            },
            {
                day: 30,
                riddle: {
                    text: "I rise with the morning but I'm not the sun,\nI herald the day before it's begun.\nWith feathers and beak, I greet the dawn,\nMy alarm clock cry wakes the farm and the lawn.",
                    answers: ["rooster", "a rooster", "cockerel", "chicken"]
                },
                joke: {
                    text: "What do you call a chicken looking at a bowl of lettuce?",
                    answers: ["chicken sees a salad", "chicken caesar salad", "chicken sees salad"]
                },
                quiz: {
                    text: "How many continents are there on Earth?",
                    options: ["5", "6", "7", "8"],
                    correct: "C",
                    explanation: "There are 7 continents: Africa, Antarctica, Asia, Australia, Europe, North America, and South America!"
                },
                pun: "That rooster joke was eggs-actly what I needed! üêì"
            }
        ];

        // ==================== UTILITY FUNCTIONS ====================
        function getDayIndex() {
            const startDate = new Date('2025-01-01').getTime();
            const today = new Date().setHours(0, 0, 0, 0);
            const daysSinceStart = Math.floor((today - startDate) / 86400000);
            return Math.abs(daysSinceStart) % contentBank.length;
        }

        function getTodayKey() {
            const today = new Date();
            return `dailychuckle_${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
        }

        function getYesterdayKey() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            return `dailychuckle_${yesterday.getFullYear()}-${String(yesterday.getMonth() + 1).padStart(2, '0')}-${String(yesterday.getDate()).padStart(2, '0')}`;
        }

        // ==================== STREAK MANAGEMENT ====================
        function getStreak() {
            return parseInt(localStorage.getItem('dailychuckle_streak') || '0');
        }

        function setStreak(value) {
            localStorage.setItem('dailychuckle_streak', value.toString());
        }

        function getLastChampionDate() {
            return localStorage.getItem('dailychuckle_last_champion');
        }

        function setLastChampionDate(dateKey) {
            localStorage.setItem('dailychuckle_last_champion', dateKey);
        }

        function updateStreak(isChampion) {
            const todayKey = getTodayKey();
            const yesterdayKey = getYesterdayKey();
            const lastChampionDate = getLastChampionDate();

            if (isChampion) {
                if (lastChampionDate === yesterdayKey) {
                    setStreak(getStreak() + 1);
                } else if (lastChampionDate !== todayKey) {
                    setStreak(1);
                }
                setLastChampionDate(todayKey);
            } else {
                setStreak(0);
            }

            return getStreak();
        }

        function displayStreak() {
            const streak = getStreak();
            const streakBadge = document.getElementById('streakBadge');
            const streakCount = document.getElementById('streakCount');

            streakCount.textContent = streak;

            if (streak >= 1) {
                streakBadge.classList.add('champion');
            } else {
                streakBadge.classList.remove('champion');
            }
        }

        // ==================== ANSWER MATCHING ====================
        function fuzzyMatch(userAnswer, correctAnswers) {
            if (!userAnswer) return false;
            const normalized = userAnswer.toLowerCase().trim().replace(/[^a-z0-9\s]/g, '');
            return correctAnswers.some(ans => {
                const normalizedAns = ans.toLowerCase().trim();
                return normalized.includes(normalizedAns) || normalizedAns.includes(normalized);
            });
        }

        // ==================== STORAGE ====================
        function checkCompleted() {
            const todayKey = getTodayKey();
            const saved = localStorage.getItem(todayKey);
            return saved ? JSON.parse(saved) : null;
        }

        function saveCompletion(score, isChampion) {
            const todayKey = getTodayKey();
            const streak = updateStreak(isChampion);
            localStorage.setItem(todayKey, JSON.stringify({
                completed: true,
                score: score,
                isChampion: isChampion,
                streak: streak,
                timestamp: Date.now()
            }));
            return streak;
        }

        // ==================== CONTENT LOADING ====================
        function loadContent() {
            const dayIndex = getDayIndex();
            const content = contentBank[dayIndex];

            document.getElementById('dayDisplay').textContent = `Day ${dayIndex + 1}`;
            document.getElementById('riddleText').textContent = content.riddle.text;
            document.getElementById('jokeText').textContent = content.joke.text;
            document.getElementById('quizText').textContent = content.quiz.text;

            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = '';
            const letters = ['A', 'B', 'C', 'D'];
            content.quiz.options.forEach((option, index) => {
                const label = document.createElement('label');
                label.className = 'quiz-option';
                label.innerHTML = `
                    <input type="radio" name="quiz" value="${letters[index]}">
                    <span><strong>${letters[index]}.</strong> ${option}</span>
                `;
                label.addEventListener('click', function() {
                    document.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                });
                optionsContainer.appendChild(label);
            });

            displayStreak();
        }

        // ==================== SUBMIT & RESULTS ====================
        function submitAnswers() {
            // Initialize audio on user interaction (required by browsers)
            AudioSystem.init();

            const dayIndex = getDayIndex();
            const content = contentBank[dayIndex];

            const riddleAnswer = document.getElementById('riddleAnswer').value;
            const jokeAnswer = document.getElementById('jokeAnswer').value;
            const quizAnswer = document.querySelector('input[name="quiz"]:checked')?.value || '';

            let score = 0;
            const results = [];

            const riddleCorrect = fuzzyMatch(riddleAnswer, content.riddle.answers);
            if (riddleCorrect) score++;
            results.push({
                type: 'Riddle',
                emoji: 'üé≠',
                correct: riddleCorrect,
                userAnswer: riddleAnswer || '(no answer)',
                correctAnswer: content.riddle.answers[0]
            });

            const jokeCorrect = fuzzyMatch(jokeAnswer, content.joke.answers);
            if (jokeCorrect) score++;
            results.push({
                type: 'Joke Punchline',
                emoji: 'üòÑ',
                correct: jokeCorrect,
                userAnswer: jokeAnswer || '(no answer)',
                correctAnswer: content.joke.answers[0]
            });

            const quizCorrect = quizAnswer === content.quiz.correct;
            if (quizCorrect) score++;
            const correctIndex = ['A', 'B', 'C', 'D'].indexOf(content.quiz.correct);
            results.push({
                type: 'Brain Teaser',
                emoji: 'üß†',
                correct: quizCorrect,
                userAnswer: quizAnswer ? `${quizAnswer}. ${content.quiz.options[['A', 'B', 'C', 'D'].indexOf(quizAnswer)]}` : '(no answer)',
                correctAnswer: `${content.quiz.correct}. ${content.quiz.options[correctIndex]}`,
                explanation: content.quiz.explanation
            });

            const isChampion = score >= 2;
            const streak = saveCompletion(score, isChampion);

            showResults(score, results, content.pun, isChampion, streak);
        }

        function showResults(score, results, pun, isChampion, streak) {
            document.getElementById('challengeSection').classList.add('hidden');
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('submitContainer').classList.add('hidden');

            document.getElementById('scoreNumber').textContent = `${score}/3`;

            const scoreDisplay = document.getElementById('scoreDisplay');
            const scoreLabel = document.getElementById('scoreLabel');
            const resultCharacter = document.getElementById('resultCharacter');

            // Handle different score outcomes
            if (score === 0) {
                // TOTAL FAIL - 0 correct - HEAD BANGING
                scoreDisplay.classList.add('sad');
                scoreLabel.textContent = "Oh no...";
                resultCharacter.innerHTML = `
                    <div class="headbang-container">
                        <span class="wall">üß±</span>
                        <span class="headbang-person">üòµ</span>
                    </div>
                    <div class="wakeup-text">WAKE UP, SLEEPY...<br>YOU'RE NOT A CHUCKLE CHAMPION TODAY!</div>
                `;
                setTimeout(() => {
                    AudioSystem.sayWakeUp();
                }, 300);

            } else if (score === 1) {
                // BAD LUCK - 1 correct - CRYING WITH TEARS
                scoreDisplay.classList.add('sad');
                scoreLabel.textContent = "Better luck next time!";
                resultCharacter.innerHTML = `
                    <div class="crying-container">
                        <div class="crying-face">üò¢</div>
                        <span class="tear tear-left">üíß</span>
                        <span class="tear tear-right">üíß</span>
                        <span class="tear tear-left-2">üíß</span>
                        <span class="tear tear-right-2">üíß</span>
                    </div>
                `;
                setTimeout(() => {
                    AudioSystem.sayBadLuck();
                }, 300);

            } else if (score === 2) {
                // YOU GOT IT - 2 correct (Champion) - FIREWORKS!
                scoreDisplay.classList.add('champion');
                scoreLabel.textContent = "Chuckle Champion!";
                resultCharacter.innerHTML = '<div class="sad-person">üéâ</div>';
                setTimeout(() => {
                    AudioSystem.sayYouGotIt();
                    FireworksSystem.start(4000);
                }, 300);

            } else if (score === 3) {
                // PERFECT - 3 correct - FART + PILLOW THROW (no fireworks!)
                scoreDisplay.classList.add('champion');
                scoreLabel.textContent = "PERFECT! Chuckle Champion!";

                // Pillow thrower animation
                resultCharacter.innerHTML = `
                    <div class="pillow-thrower">
                        <span class="pillow-person">üí™üòé</span>
                        <span class="flying-pillow">üõèÔ∏è</span>
                    </div>
                `;

                // Play the fart sound immediately
                setTimeout(() => {
                    AudioSystem.playFartSound();
                }, 200);
            }

            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = '';

            results.forEach(result => {
                const div = document.createElement('div');
                div.className = `result-item ${result.correct ? 'correct' : 'incorrect'}`;
                div.innerHTML = `
                    <div class="result-icon">${result.correct ? '‚úÖ' : '‚ùå'}</div>
                    <div class="result-content">
                        <div class="result-label">${result.emoji} ${result.type}</div>
                        <div class="result-answer">Your answer: ${result.userAnswer}</div>
                        ${!result.correct ? `<div class="result-answer">Correct: ${result.correctAnswer}</div>` : ''}
                        ${result.explanation && !result.correct ? `<div class="result-explanation">${result.explanation}</div>` : ''}
                    </div>
                `;
                resultsContainer.appendChild(div);
            });

            // Show champion banner and pun if 2+ correct
            if (isChampion) {
                const championBanner = document.getElementById('championBanner');
                const championStreak = document.getElementById('championStreak');
                championStreak.textContent = streak === 1
                    ? "You're on a 1 day streak!"
                    : `You're on a ${streak} day streak!`;

                setTimeout(() => {
                    championBanner.classList.add('visible');
                }, 800);

                const punSection = document.getElementById('punSection');
                document.getElementById('punText').textContent = pun;
                setTimeout(() => {
                    punSection.classList.add('visible');
                }, 1100);
            }

            displayStreak();
        }

        // ==================== COMPLETED STATE ====================
        function showCompletedState(savedData) {
            document.getElementById('challengeSection').classList.add('hidden');
            document.getElementById('submitContainer').classList.add('hidden');
            document.getElementById('completedSection').classList.remove('hidden');
            document.getElementById('completedScore').textContent = `${savedData.score}/3`;

            if (savedData.isChampion && savedData.streak > 0) {
                const completedStreak = document.getElementById('completedStreak');
                completedStreak.classList.remove('hidden');
                completedStreak.textContent = `üî• ${savedData.streak} day streak!`;
            }
        }

        // ==================== INITIALIZATION ====================
        function init() {
            // Preload speech synthesis voices
            if ('speechSynthesis' in window) {
                speechSynthesis.getVoices();
                speechSynthesis.onvoiceschanged = () => {
                    speechSynthesis.getVoices();
                };
            }

            const completed = checkCompleted();
            if (completed) {
                loadContent();
                showCompletedState(completed);
            } else {
                loadContent();
            }
        }

        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed:', err));
        }

        // Run on load
        init();
    </script>
</body>
</html>
